
@using X.PagedList.Mvc.Core;
@using X.PagedList;

@{
    ViewData["Title"] = "RepairInquire";
}

 <!-- Page Header Start -->
    <div
      class="container-fluid page-header py-5 wow fadeIn"
      data-wow-delay="0.1s"
    >
      <div class="container text-center py-5">
        <h1 class="display-2 text-dark mb-4 animated slideInDown">維修服務</h1>
        <nav aria-label="breadcrumb animated slideInDown">
          <ol class="breadcrumb justify-content-center mb-0">
            <li class="breadcrumb-item">
                    <a asp-area="" asp-controller="Repair" asp-action="Create">維修申請</a>
                </li>
            <li class="breadcrumb-item text-dark" aria-current="page">
              維修紀錄查詢
            </li>
            <!-- <li class="breadcrumb-item text-dark" aria-current="page">Products</li> -->
          </ol>
        </nav>
      </div>
    </div>
    <!-- Page Header End -->

    <!-- Products Start -->
    <d  iv class="container-fluid product py-5">
      <div class="container py-5">
        <div
          class="section-title text-center mx-auto wow fadeInUp"
          data-wow-delay="0.1s"
        >
          <h1 class="display-6">維修紀錄查詢</h1>
        </div>

        <!-- Bootstrap Table with Header - Dark -->
       <div class="card custom-wide-card">
          <div class="table-responsive text-nowrap align-content-center">
            <table class="table">
              <thead class="table-dark">
                <tr>
                  <th>維修序號</th>
                  <th>報修日期</th>
                  <th>報修項目</th>
                  <th>處理狀態</th>
                  <th>操作</th>
                </tr>
              </thead>


              <tbody class="table-border-bottom-0">
                <tr>
                  <td>
                    <div class="d-flex align-items-center">
                      <!-- 使用 Flex 布局来将内容水平居中对齐 -->
                      <i class="fa-solid fa-magnifying-glass"></i>
                      @using (Html.BeginForm("RepairInquire", "RepairsAPI", FormMethod.Get, new { id = "searchForm" } ))
    {
        @Html.TextBox("txtKeyword", null, new { @class = "form-control form-date-control", placeholder = "關鍵字搜尋", @id = "searchInput" })
        @*一起提交*@
        <input type="submit" value="搜尋" class="btn btn-primary" hidden>


        @*搜尋日期*@
        <td>
         <div class="d-flex align-items-center">
            <label class="" for="inputName">搜尋日期</label>
            @Html.TextBox("txtKeywordDate", null, new { @class = "form-control form-date-control", type = "date", id = "datepicker" })
            <input type="submit" value="搜尋日期" class="btn btn-primary" hidden>
        </div>
        </td>

        @*篩選搜尋報修項目*@
         <td>
                    
                    <select class="form-select" name="txtKeywordItems" id="txtKeywordItems">
                        @if (ViewBag.RepairItems == null){
                            <option value="" disabled selected>搜尋報修項目</option>
                        }
                         else
                        {
                            <option value="" disabled>搜尋報修項目</option>                       
                        }

                         @if (ViewBag.RepairItems == "電梯")
                         {
                             <option value="電梯" selected>電梯</option>
                         }
                         else
                         {
                             <option value="電梯">電梯</option>                    
                         }

                         @if (ViewBag.RepairItems == "衛浴")
                         {
                             <option value="衛浴" selected>衛浴</option>
                         }
                         else
                         {
                             <option value="衛浴">衛浴</option>                
                         }

                         @if (ViewBag.RepairItems == "廚房")
                         {
                             <option value="廚房" selected>廚房</option>
                         }
                         else
                         {
                             <option value="廚房">廚房</option>                
                         }
                         
                          @if (ViewBag.RepairItems == "水電")
                         {
                             <option value="水電" selected>水電</option>
                         }
                         else
                         {
                             <option value="水電">水電</option>                
                         }
                         
                          @if (ViewBag.RepairItems == "裝修")
                         {
                             <option value="裝修" selected>裝修</option>
                         }
                         else
                         {
                             <option value="裝修">裝修</option>                
                         }

                         @if (ViewBag.RepairItems == "其它")
                         {
                             <option value="其它" selected>其它</option>
                         }
                         else
                         {
                             <option value="其它">其它</option>                
                         }
                      

                    </select>                   
                    
                    
                  </td>
                        
                    <td>
                    <select  class="form-select" name="txtKeywordState" id="txtKeywordState">

                     @if (ViewBag.RepairStatus == null){
                            <option value="" disabled selected>搜尋處理狀態</option>
                        }
                         else
                        {
                            <option value="" disabled>搜尋處理狀態</option>                       
                        }

                        @if (ViewBag.RepairStatus == "未處理")
                         {
                             <option value="未處理" selected>未處理</option>
                         }
                         else
                         {
                             <option value="未處理">未處理</option>                    
                         }

                          @if (ViewBag.RepairStatus == "處理中")
                         {
                             <option value="處理中" selected>處理中</option>
                         }
                         else
                         {
                             <option value="處理中">處理中</option>                    
                         }

                          @if (ViewBag.RepairStatus == "已完成")
                         {
                             <option value="已完成" selected>已完成</option>
                         }
                         else
                         {
                             <option value="已完成">已完成</option>                    
                         }
                </select>
                 
                   
                   
                  </td>
                  <td>
                    <button id="searchButton" type="button" class="btn btn-primary">搜尋</button>
                  </td>
}
                   
              </tbody>
            </table>

 @*每10筆資料一頁頁碼資料*@
 <div class="d-flex justify-content-center">
    <nav aria-label="Page navigation example">
        <ul class="pagination">
            <li class="page-item">
                @{
                    // 计算前一页的页码，确保不小于 1
                    int prevPageNumber = ViewBag.RepairPage.PageNumber - 1;
                    if (prevPageNumber < 1)
                    {
                        prevPageNumber = 1;
                    }
                }
                <a class="

" href="@Url.Action("RepairInquire", new { Page = prevPageNumber })" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            @for (int i = 1; i <= ViewBag.RepairPage.PageCount; i++)
            {
                <li class="page-item @(i == ViewBag.RepairPage.PageNumber ? "active" : "")">
                    <a class="page-link" href="@Url.Action("RepairInquire", new { Page = i })">@i</a>
                </li>
            }
            <li class="page-item">
                @{
                    // 计算下一页的页码，确保不超过最大页数
                    int nextPageNumber = ViewBag.RepairPage.PageNumber + 1;
                    if (nextPageNumber > ViewBag.RepairPage.PageCount)
                    {
                        nextPageNumber = ViewBag.RepairPage.PageCount;
                    }
                }
                <a class="page-link" href="@Url.Action("RepairInquire", new { Page = nextPageNumber })" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>
</div>
@*\\每10筆資料一頁頁碼資料*@

@*每10筆資料一頁頁碼資料*@
@* <div class="pagination">
    @Html.PagedListPager((IPagedList)ViewBag.RepairPage, page => Url.Action("RepairInquire", new { Page = page }))
</div>*@

          </div>
        </div>
        <!--/ Bootstrap Table with Header Dark -->
    @*@section Scripts {*@
   
@*}*@

<script>
            document.getElementById("searchButton").addEventListener("click", function () {
                var txtKeywordItems = document.getElementById("txtKeywordItems").value;
                var txtKeywordState = document.getElementById("txtKeywordState").value;

                // 构建API端点URL，替换为实际的API端点
                var apiUrl = `/api/RepairsAPI/RepairInquire?txtKeywordItems=${txtKeywordItems}&txtKeywordState=${txtKeywordState}`;

                fetch(apiUrl)
                    .then(response => response.json())
                    .then(data => {
                        // 处理API返回的数据，更新页面
                        // 示例：更新表格数据
                        var tableBody = document.querySelector(".table tbody");
                        tableBody.innerHTML = ""; // 清空表格内容

                        data.forEach(item => {
                            var row = document.createElement("tr");
                            row.innerHTML = `
                                <td>${item.RepairCode}</td>
                                <td>${item.Time}</td>
                                <td>${item.Type}</td>
                                <td>${item.ProcessingStatus}</td>
                                <td>
                                    <div class="link-container">
                                        <a href="${item.EditUrl}">修改</a> |
                                        <a href="${item.DeleteUrl}" onclick="return confirm('確定要刪除嗎?')">刪除</a> |
                                        <a href="${item.DetailsUrl}">查看詳情</a>
                                    </div>
                                </td>
                            `;
                            tableBody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            });
    @*// 获取日期输入框和隐藏的提交按钮*@
    const dateInput = document.getElementById('datepicker');
    const submitButton = document.querySelector('input[type="submit"]');

    @*// 监听日期输入框的值改变事件*@
    dateInput.addEventListener('change', function () {
       @* // 自动点击隐藏的提交按钮*@
        submitButton.click();
    });
</script>
        
      </div>
    </d>
    <!-- Products End -->
