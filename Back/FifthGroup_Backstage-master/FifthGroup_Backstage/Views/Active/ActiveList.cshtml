@model IEnumerable<FifthGroup_Backstage.Models.Application>

@{
    ViewData["Title"] = "ActiveList";
}


<!-- Content wrapper -->
<div class="content-wrapper">
    <!-- Content -->

    <div class="container-xxl flex-grow-1 container-p-y">
        <div class="container-fluid page-header fadeIn">
            <div class="container text-center py-2">
                <h1 class="display-3 text-dark animated slideInDown">用戶活動管理</h1>
                <nav aria-label="breadcrumb animated slideInDown">
                    <ol class="breadcrumb justify-content-center mb-0">
                        @if (ViewBag.isNow)
                        {
                            <li class="breadcrumb-item  text-dark" aria-current=" page">活動查看</li>
                            <li class="breadcrumb-item"><a asp-area="" asp-controller="Active" asp-action="ActiveCheck">活動審核</a></li>
                            <li class="breadcrumb-item"><a asp-area="" asp-controller="Active" asp-action="ActiveList" asp-route-isNow="False">歷史活動</a></li>
                        }
                        else
                        {
                            <li class="breadcrumb-item"><a asp-area="" asp-controller="Active" asp-action="ActiveList" asp-route-isNow="true">活動查看</a></li>
                            <li class="breadcrumb-item"><a asp-area="" asp-controller="Active" asp-action="ActiveCheck">活動審核</a></li>
                            <li class="breadcrumb-item  text-dark" aria-current=" page">歷史活動</li>
                        }
                    </ol>
                </nav>
            </div>
        </div>
        @*搜索*@
        <form method="get" asp-action="ActiveList" class="container-fluid product py-2 col-5">
            <div class="input-group mb-4">
                <div style="margin:2px">
                    <select class="form-select" name="searchType" id="searchType">
                        @if (ViewBag.searchType != "")
                        {

                            var SearchType = new List<string> { "", "運動", "休閒", "文藝", "社交", "教育", "義工", "健康", "節慶", "戶外" };
                            <option value="@SearchType[0]">全部活動種類</option>
                            for (int i = 1; i < SearchType.Count(); i++)
                            {
                                if (SearchType[i] == ViewBag.searchType)
                                {
                                    <option value="@SearchType[i]" selected>@SearchType[i]</option>

                                }
                                else
                                {
                                    <option value="@SearchType[@i]">@SearchType[i]</option>
                                }
                            }
                        }
                        else
                        {
                            <option value="" selected>選擇活動種類</option>
                            <option value="運動">運動</option>
                            <option value="休閒">休閒</option>
                            <option value="文藝">文藝</option>
                            <option value="社交">社交</option>
                            <option value="教育">教育</option>
                            <option value="義工">義工</option>
                            <option value="健康">健康</option>
                            <option value="節慶">節慶</option>
                            <option value="戶外">戶外</option>
                        }
                    </select>
                </div>
                <div style="margin:2px">
                    @Html.TextBox("startDate", null, new { @class = "form-control form-date-control", type = "date", id = "startDate" })
                </div>
                <div style="margin:2px">
                    @Html.TextBox("endDate", null, new { @class = "form-control form-date-control", type = "date", id = "endDate" })
                </div>
                <div>
                    <button class="btn btn-outline-secondary" type="submit">搜索</button>
                </div>
            </div>
        </form>

        @*搜索*@
        <div class="container-fluid product py-2">
            <div class="container mb-5">
                <div class="card m-3 ">
                    <div class="table-responsive text-nowrap">
                        <table class="table" style="text-align: center; vertical-align: middle;">
                            <thead class="table-dark">
                                <tr>
                                    <th>
                                        活動名稱
                                    </th>
                                    <th>
                                        活動類型
                                    </th>
                                    <th>
                                        開始時間 ~ 結束時間
                                    </th>
                                    <th>
                                        人數情況
                                    </th>
                                    <th>
                                        審核狀態
                                    </th>
                                    <th>
                                        操作
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>

                                        <td>
                                            @Html.DisplayFor(modelItem => item.ActivityName)
                                        </td>

                                        <td>
                                            @Html.DisplayFor(modelItem => item.Activities)
                                        </td>
                                        <td>
                                            @item.DateStart.ToString("yyyy/MM/dd") ~ @item.DateEnd.ToString("yyyy/MM/dd")
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Applicants) 人/ @Html.DisplayFor(modelItem => item.MaxApplicants) 人
                                        </td>
                                        <td style="text-align: center; vertical-align: middle;">
                                            @{
                                                string stateText = "";
                                                switch (item.State)
                                                {
                                                    case 0:
                                                        stateText = "未審核";
                                                        break;
                                                    case 1:
                                                        stateText = "申請中";
                                                        break;
                                                    case 2:
                                                        stateText = "已通過";
                                                        break;
                                                    case 3:
                                                        stateText = "未通過";
                                                        break;
                                                }
                                            }
                                            <span class="badge bg-label-primary me-1" style="font-size:16px">
                                                @stateText
                                            </span>
                                        </td>
                                        <td>
                                            <a asp-action="ActiveDetails" asp-route-id="@item.ApplyCode" asp-route-returnUrl="ActiveList">詳細資料</a>
                                            <a> | </a>
                                            @if (item.DateStart > DateTime.Now)
                                            {
                                                <a asp-action="ActiveEdit" asp-route-id="@item.ApplyCode" asp-route-returnUrl="ActiveList">編輯資料</a>
                                            }
                                            else
                                            {
                                                <a>編輯資料</a>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 分頁 -->
            <div class="text-center mt-4">
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center">
                        @for (int i = 1; i <= Math.Ceiling((double)ViewBag.TotalCount / ViewBag.PageSize); i++)
                        {
                            <li class="page-item @(i == ViewBag.Page ? "active" : "")">
                                <a class="page-link" href="@Url.Action("ActiveList", new { page = i })">@i</a>
                            </li>
                        }
                    </ul>
                </nav>
            </div>
        </div>
</div>
</div>










<script>
    $(document).ready(function () {
        // 獲取ViewBag值
        var startDate = "@ViewBag.searchDateStart"
        var endDate = "@ViewBag.searchDateEnd"
        var Type = "@ViewBag.searchType"

        //賦值給選項
        var selectElement = document.getElementById("searchType");

        $('#startDate').datepicker({
            defaultDate: startDate
        });
        $('#endDate').datepicker({
            defaultDate: endDate
        });
        if (Type.HasValue) {
            selectElement.value = Type;
        }
    });
</script>